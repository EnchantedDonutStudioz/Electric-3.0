!function(){var e,t,g=window["%hammerhead%"];if(!g)throw new Error("hammerhead not loaded yet");if(g.settings._settings.sessionId)console.warn("unexpected task.js to load before rammerhead.js. url shuffling cannot be used"),r();else{e=r,t=g.__proto__.start,g.__proto__.start=function(){t.apply(this,arguments),g.__proto__.start=t,e()};var s=new XMLHttpRequest,l=(location.pathname.slice(1).match(/^[a-z0-9]+/i)||[])[0];if(l)if(s.open("GET","/api/shuffleDict?id="+l,!1),s.send(),200!==s.status)console.warn(`received a non 200 status code while trying to fetch shuffleDict:
status: ${s.status}
response: `+s.responseText);else{l=JSON.parse(s.responseText);if(l){let i=(e,t)=>(e%t+t)%t,a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~-",e="_rhs";class c{constructor(e=function(){let e="";for(var t=a.split("");0<t.length;)e+=t.splice(Math.floor(Math.random()*t.length),1)[0];return e}()){this.dictionary=e}shuffle(t){if(t.startsWith(e))return t;let r="";for(let e=0;e<t.length;e++){var n=t.charAt(e),o=a.indexOf(n);"%"===n&&3<=t.length-e?r=(r=(r+=n)+t.charAt(++e))+t.charAt(++e):r+=-1===o?n:this.dictionary.charAt(i(o+e,a.length))}return e+r}unshuffle(t){if(!t.startsWith(e))return t;t=t.slice(e.length);let r="";for(let e=0;e<t.length;e++){var n=t.charAt(e),o=this.dictionary.indexOf(n);"%"===n&&3<=t.length-e?r=(r=(r+=n)+t.charAt(++e))+t.charAt(++e):r+=-1===o?n:a.charAt(i(o-e,a.length))}return r}}let n=(e,n)=>(e||"").replace(/^((?:[a-z0-9]+:\/\/[^/]+)?(?:\/[^/]+\/))([^]+)/i,function(e,t,r){return t+n(r)}),o=new c(l);s=location.href,l=n(location.href,e=>o.shuffle(e));s!==l&&history.replaceState(null,null,l);let r=g.utils.url.getProxyUrl,t=g.utils.url.parseProxyUrl;g.utils.url.overrideGetProxyUrl(function(e,t){return v?r(e,t):n(r(e,t),e=>o.shuffle(e))}),g.utils.url.overrideParseProxyUrl(function(e){return t(n(e,e=>o.unshuffle(e)))}),window.overrideGetProxyUrl(r=>function(e,t){return v?r(e,t):n(r(e,t),e=>o.shuffle(e))}),window.overrideParseProxyUrl(t=>function(e){return t(n(e,e=>o.unshuffle(e)))})}}else console.warn("cannot get session id from url")}function r(){{let r=location.port||("https:"===location.protocol?"443":"80"),n=g.utils.url.getProxyUrl;g.utils.url.overrideGetProxyUrl(function(e,t={}){return t.proxyPort||(t.proxyPort=r),n(e,t)}),window.overrideParseProxyUrl(t=>function(e){e=t(e);return e&&e.proxy&&(e.proxy.port||(e.proxy.port=r)),e})}{let e={HTMLAnchorElement:["href"],HTMLAreaElement:["href"],HTMLBaseElement:["href"],HTMLEmbedElement:["src"],HTMLFormElement:["action"],HTMLFrameElement:["src"],HTMLIFrameElement:["src"],HTMLImageElement:["src"],HTMLInputElement:["src"],HTMLLinkElement:["href"],HTMLMediaElement:["src"],HTMLModElement:["cite"],HTMLObjectElement:["data"],HTMLQuoteElement:["cite"],HTMLScriptElement:["src"],HTMLSourceElement:["src"],HTMLTrackElement:["src"]};for(var r in e)for(var n of e[r])if(window[r]){var o=Object.getOwnPropertyDescriptor(window[r].prototype,n);let t=o.get;if(o.get=function(){return e=t.call(this),(g.utils.url.parseProxyUrl(e)||{}).destUrl||e;var e},"action"===n){let r=o.set;o.set=function(e){v=!0;try{var t=r.call(this,e)}catch(e){throw v=!1,e}return v=!1,t}}Object.defineProperty(window[r].prototype,n,o)}else console.warn("unexpected unsupported element class "+r)}{let t=e=>new URL(g.utils.url.parseProxyUrl(e.location.href).destUrl).host,r=e=>`rammerhead|storage-wrapper|${g.settings._settings.sessionId}|${t(e)}|`,a=(e="",t=window)=>r(t)+e,s=(e="",t=window)=>e.startsWith(r(t))?e.slice(r.length):null,e=(e,o)=>{let i=["internal","clear","key","getItem","setItem","removeItem","length"];Object.defineProperty(window,e,{configurable:!0,writable:!0,value:new Proxy(window[e],{get(e,t,r){if(i.includes(t)&&"length"!==t)return Reflect.get(e,t,r);if("length"!==t)return o[a(t)];{let e=0;for(var[n]of Object.entries(o))s(n)&&e++;return e}},set(e,t,r){return i.includes(t)||(o[a(t)]=r),!0},deleteProperty(e,t){return delete o[a(t)],!0},has(e,t){return a(t)in o||t in e},ownKeys(){var e,t=[];for([e]of Object.entries(o)){var r=s(e);r&&!i.includes(r)&&t.push(r)}return t},getOwnPropertyDescriptor(e,t){return Object.getOwnPropertyDescriptor(o,a(t))},defineProperty(e,t,r){return i.includes(t)||Object.defineProperty(o,a(t),r),!0}})})},n=(e,n)=>{Storage.prototype[e]=new Proxy(Storage.prototype[e],{apply(e,t,r){return n.apply(t,r)}})};e("localStorage",g.storages.localStorageProxy.internal.nativeStorage),e("sessionStorage",g.storages.sessionStorageProxy.internal.nativeStorage),n("clear",function(){for(var[e]of Object.entries(this))delete this[e]}),n("key",function(e){return(Object.entries(this)[e]||[])[0]||null}),n("getItem",function(e){return this.internal.nativeStorage[a(e,this.internal.ctx)]||null}),n("setItem",function(e,t){e&&(this.internal.nativeStorage[a(e,this.internal.ctx)]=t)}),n("removeItem",function(e){delete this.internal.nativeStorage[a(e,this.internal.ctx)]})}if(delete window.overrideGetProxyUrl,delete window.overrideParseProxyUrl,delete window.overrideIsCrossDomainWindows,window.rammerheadStartListeners){for(var e of window.rammerheadStartListeners)try{e()}catch(e){console.error(e)}delete window.rammerheadStartListeners}if(window.rammerheadDisableLocalStorageImplementation)delete window.rammerheadDisableLocalStorageImplementation;else{var i="rammerhead_synctimestamp",t=!1,a=localStorage,s=a.internal.nativeStorage,l=g.settings._settings.sessionId,c=window.__get$(window,"location").origin,u=[];try{t=!0;var d,f=function(){var e=s[i],t=parseInt(e);if(isNaN(t))return e&&console.warn("invalid timestamp retrieved from storage: "+e),null;return t}();function p(e){if(!e||"object"!=typeof e)throw new TypeError("data must be an object");for(var t in a.clear(),e)a[t]=e[t]}f?(d=w({type:"sync",timestamp:f,data:a})).timestamp&&(h(d.timestamp),p(d.data)):(d=w({type:"sync",fetch:!0})).timestamp&&(h(d.timestamp),p(d.data)),t=!1}catch(e){if("server wants to disable localStorage syncing"!==e.message)throw e;return}a.addChangeEventListener(function(e){t||-1===u.indexOf(e.key)&&u.push(e.key)}),setInterval(function(){var e=y();e&&(w({type:"update",updateData:e},function(e){h(e.timestamp)}),u=[])},5e3),document.addEventListener("visibilitychange",function(){var e;"hidden"===document.visibilityState&&(e=y())&&g.nativeMethods.sendBeacon.call(window.navigator,m(),JSON.stringify({type:"update",updateData:e}))})}function h(e){if(!e)throw new TypeError("timestamp must be defined");if(isNaN(parseInt(e)))throw new TypeError("timestamp must be a number. received"+e);s[i]=e}function m(){return"/syncLocalStorage?sessionId="+encodeURIComponent(l)+"&origin="+encodeURIComponent(c)}function w(e,t){if(!e||"object"!=typeof e)throw new TypeError("data must be an object");var r=g.createNativeXHR();function n(){if(404===r.status)throw new Error("server wants to disable localStorage syncing");if(200!==r.status)throw new Error("server sent a non 200 code. got "+r.status+". Response: "+r.responseText)}if(r.open("POST",m(),!!t),r.setRequestHeader("content-type","application/json"),r.send(JSON.stringify(e)),!t)return n(),JSON.parse(r.responseText);r.onload=function(){n(),t(JSON.parse(r.responseText))}}function y(){if(!u.length)return null;for(var e={},t=0;t<u.length;t++)e[u[t]]=a[u[t]];return u=[],e}}var v=!1}();